## 1. Introdução

O objetivo deste projeto final de engenharia (PFE) é desenvolver um processador
baseado na arquitetura RISC-V, proposto pelo Centro de Tecnologia da Informação
Renato Archer (CTI) para uso em aplicações aeroespaciais. A princípio, este
projeto surgiu da necessidade de tornar o Brasil independente no setor de
tecnologia aeroespacial e desenvolver processadores para os satélites do
programa espacial nacional dentro do país. Uma vez que o cliente não possui uma
arquitetura de processador própria, como ARM (_Advanced RISC Machine_) da ARM Holdings
e x86 da Intel, há dependência de Propriedade Intelectual (Intellectual Property - IP) de 
empresas que vendem processadores, o que pode levar à falta destes componentes no Brasil 
dependendo da oferta disponível do mercado ou caso ocorram conflitos de interesse. Como 
solução para o problema apresentado, foi proposto o projeto pelo CTI como tema de PFE de 
longo prazo para os alunos de Engenharia da Computação, sendo a arquitetura RISC-V a arquitetura
aberta de escolha do cliente.

Foi acordado entre os alunos realizando o PFE e os membros da CTI que, até a
entrega intermediária, deve-se ter como resultado a base do que se deseja
desenvolver: um processador RISC-V funcional, desenvolvido seguindo boas
práticas de desenvolvimento, como desenvolvimento hierárquico modular para
facilitar a atualização do projeto para suportar uma arquitetura com tolerância
a falhas ao processador. Também deve ser criado um ambiente de testes de unidade
e de integração em um ambiente de desenvolvimento conteinerizado, utilizando
Docker, para que a infraestrutura seja replicável.

O projeto não demonstra ter questões no âmbito legal, e pode ter uso prático
futuramente de acordo com as necessidades do CTI, porém como a proposta do CTI é
desenvolver o projeto a longo prazo em parceria com o Insper, sendo este PFE a
primeira etapa para a criação da IP desejada, o andamento
do projeto fica dependente do interesse de alunos do PFE do Insper de semestres
posteriores continuarem o desenvolvimento.

### 1.1 Escopo do projeto

Após conversas com o cliente, o escopo do projeto foi definido como sendo o
desenvolvimento de um processador funcional com testes unitários e de integração
implementados, sendo que a empresa seria responsável pela fabricação da CPU.

1. O que faz parte do projeto
   - Desenvolvimento de um processador baseado na arquitetura RISC-V;
   - Infraestrutura de testes unitários e de integração para o processador e
     seus componentes;
   - Criação de um manual com o guia de uso e referência para o projeto e o
     processador.
2. O que não faz parte do projeto
   - Fabricação da CPU

Até o momento, foram desenvolvidos os componentes necessários para que o
processador execute as 37 instruções do Conjunto Base de Inteiros para uma 
arquitetura de 32 _bits_, que foram determinadas como sendo o requisito 
de entrega junto ao cliente, com todos os componentes individuais tendo pelo menos
um caso de teste implementado. Foi realizada também a integração desses
componentes entre si, com a mesma sendo testada por meio da execução das
instruções mencionadas. 
Essa integração fica mais clara ao observar a Figura 1, onde está
representado o diagrama do processador desenvolvido até o momento, com os
barramentos representando os registradores entre as etapas da _pipeline_.

![Topologia do Top Level](../public/images/reference/report_components/top_level.drawio.svg **Figura 1** - Diagrama do processador implementado, ilustração baseada em um simulador _web_ de RISC-V (MARIOTTI; GIORGI, 2022)")

### 1.2 Recursos

Para o desenvolvimento do processador, foi necessário o uso de um conjunto de
ferramentas:

- **Visual Studio Code**, um editor de texto muito utilizado por programadores para desenvolver código, 
  com propósito de facilitar o processo de desenvolvimento e teste do processador e seus componentes (MICROSOFT, 2015);
- **GHDL**, uma ferramenta open-source de sintetização para o projeto em VHDL e
  simulação dos componentes (GINGOLD, 2023);
- **Yosys**, é uma ferramenta open-source de sintetização e elaboração do
  projeto em VHDL (WOLF, 2020);
- **Netlistsvg**, é uma ferramenta open-source de elaboração de diagramas
  vetoriais dos componentes para o Yosys (TURLEY, 2016);
- **Cocotb**, um framework open-source de verificação de design de chips em
  python, com propósito de testar os componentes desenvolvidos (COCOTB, [s.d.]);
- **Pytest**, um framework open-source de testes em python, com propósito de
  testar os componentes desenvolvidos (KREKEL; TEAM, 2015);
- **GitHub**, um ambiente de desenvolvimento colaborativo com controle de
  versão, com propósito de gestão do projeto e automação da execução de testes
  unitários e de integração por meio de uma infraestrutura em nuvem (GITHUB, [s.d.]);
- **GitHub Pages**, uma infraestrutura em nuvem, com propósito de publicar o
  guia de uso e documentação do projeto on-line (GITHUB PAGES, [s.d.]).
- **Quartus**, um software de design de dispositivos lógicos da Intel (INTEL, [s.d.]).

### 1.3 Cronograma

O cronograma do projeto pode ser visto na Tabela Cronograma:

::: danger TO DO

Cronograma

:::

### 1.4 Mapeamento dos _stakeholders_

O mapeamento dos _stakeholders_ pode ser visto na Tabela _Stakeholders_:

|                        _Stakeholder_                        |          Posição          |   Papel no Projeto    | Expectativas                                                                                                                                     |
| :---------------------------------------------------------: | :-----------------: | :-------------------: | :----------------------------------------------------------------------------------------------------------------------------------------------- |
|                         Saulo Finco                         |    Tecnologista Sênior    | Orientador da empresa | Desenvolvimento de um RISC-V para uso aeroespacial com infraestrutura CI/CD de testes para a criação de uma propriedade intelectual baseada nele |
| Líderes do CTI/Ministério da Ciência, Tecnologia e Inovação |     Empresa parceira      |   Empresa parceira    | Desenvolvimento em uma propriedade intelectual baseada no RISC-V para obter soberania no setor aeroespacial                                      |
|                        Rafael Corsi                         |         Professor         | Professor orientador  | Desenvolvimento de um RISC-V com infraestrutura CI/CD de testes, utilizando os conceitos aprendidos durante o curso pelos alunos                 |
|                      RISC-V International                   | Organização Internacional | Entidade interessada  | Desenvolvimento da arquitetura RISC-V, maior contribuição do Brasil para a RISC-V International                                                 |

**Tabela _Stakeholders_** - Tabela de mapeamento dos _stakeholders_

### 1.5 Questões Éticas e Profissionais

Um passo na busca pela soberania do Brasil no setor de tecnologia aeroespacial está na posse
de conhecimento prático do desenvolvimento de componentes de eletrônica avançada utilizados
em programas espaciais. A dependência de empresas que possuem as propriedades intelectuais 
desses componentes, o que faz o uso dessas tecnologias ocorrer por meio de licenças, pode comprometer 
o desenvolvimento desses programas no Brasil por oferta do mercado ou conflitos de interesse.

Por isso, o desenvolvimento do RISC-V, uma arquitetura aberta gerida por uma entidade internacional
da qual o Brasil faz parte desde o final de fevereiro de 2024 (MINISTÉRIO DA CIÊNCIA, TECNOLOGIA E INOVAÇÃO, 2024), 
é de interesse da nação brasileira e da RISC-V International, assim como dos países presentes nesta organização. 

### 1.6 Normas Técnicas

Utilizou-se das normas definidas pela entidade que é responsável pela
especificação da arquitetura RISC-V (2022, RISC-V International), onde se define
que o processador deve ser capaz de interpretar um conjunto de instruções, que
está especificado no Anexo A, e quaisquer futuras iterações do projeto devem
seguir essas normas também.

Além disso, o grupo padronizou o desenvolvimento do projeto, como está explícito no 
Apêndice A, de forma a facilitar o desenvolvimento e futuras implementações, e é 
recomendado seguir o mesmo padrão. Caso se opte por alterá-lo, deve-se indicar as razões pelas
quais tal decisão foi tomada.

### 1.7 Revisão do Estado da Arte

O RISC-V é um ISA (_Instruction Set Architecture_), como o nome diz, da categoria RISC 
(_Reduced Instruction Set Computing_). Entretanto existe outra categoria de arquitetura 
que é o CISC (_Complex Instruction Set Computing_) que possui características diferentes do
RISC.

O conjunto de instruções CISC tem como abordagem reduzir o número de instruções 
de um programa (GUL; AFTAB; ARFA, 2016). O CISC faz isso criando um hardware que 
é capaz de entender e executar uma série de operações identificadas por instruções 
mais complexas do que as presentes em arquiteturas RISC, porém menores em quantidade 
(“RISC vs CISC”, 2000). Como consequência, os chips CISC possuem uma grande quantidade 
de instruções com comportamentos variados e especializados em uma tarefa. Isso ocorreu 
seguindo o raciocínio de que o hardware é sempre mais rápido que o software, e, portanto,
deveria se criar um conjunto de instruções que permita que diversas tarefas sejam realizadas com o 
menor número de linhas de código de máquina. No entanto, como uma única instrução é 
responsável por executar várias coisas, o tempo de execução delas não é constante, diferente 
do RISC (GAO; TANG; DING, [s.d.]). Outra característica do CISC é que por permitir a 
criação de programas mais compactos, o uso de memória é menor, já que quanto maior o 
programa mais memória ele necessita (GUL; AFTAB; ARFA, 2016). Um exemplo de arquitetura 
CISC é o x86, criado pela Intel e aprimorado pela AMD, presente na maioria dos desktops 
e notebooks (BLEM; MENON; SANKARALINGAM, 2013).

O RISC, diferente do CISC, possui poucas instruções que podem executar em um 
único ciclo de clock. Devido a utilizar instruções mais simples permite que cada 
uma seja executada em um ciclo, diferente do CISC que possui instruções que podem 
levar mais de um ciclo para execução. Outra característica dessa arquitetura é que, 
pelo fato de utilizar poucas instruções, seus transistores, diferente do CISC que são 
utilizados para armazenar instruções complexas, são utilizados para registradores, 
diminuindo acessos a memória. Como consequência, por ter pouca variedade de instruções, 
faz com que o compilador tenha mais trabalho para converter uma linguagem de alto 
nível para código de máquina (MASOOD, 2011), já que será necessário o uso de mais instruções,
levando a uma complexidade maior no software ao invés do hardware. Um exemplo
seria a instrução de multiplicação MUL, que enquanto no CISC necessita de apenas uma linha de
código assembly, que faz toda a operação, no RISC são necessárias três: uma para carregar
os valores, outra para efetuar a multiplicação e outra para armazenar o
resultado. O exemplo decorre do fato de o CISC ser considerado
_Memory-to-memory_, ou seja, _Load_ (usa valor da memória) e _Store_ (guarda valor na memória) 
são incorporados nas instruções, o RISC é considerado _Register to register_, 
em que _Load_ e _Store_ são diferentes instruções (GUL; AFTAB; ARFA, 2016). Alguns exemplos de arquitetura
são: ARM, presente na maioria dos smartphones (ARM LTD,
[s.d.]), MIPS (_Microprocessor without Interlocked Pipeline Stages_) (MIPS,
[s.d.]) e RISC-V.

O RISC-V recebe esse nome em homenagem às 4 gerações de projetos RISC
desenvolvidos pela UC Berkeley, sendo essa a quinta. Como o nome já diz, é um
processador RISC. O RISC-V se destaca por sua
modularidade, podendo estar em aplicações mais simples até mais complexas. A
arquitetura é composta obrigatoriamente por um core, que é o conjunto de
instruções com inteiros, sendo nomeados RV(32/64/128)I ou RV32E, sendo o número
a quantidade de _bits_, o “I” de inteiro e o “E” de _embedded_, ou seja, para o uso
em sistemas embarcados que reduz o número de registradores para 16. O conjunto
de instruções também define extensões, o que explica a modularidade, que podem
ser: M para multiplicação e divisão de inteiros, A para instruções atômicas, F
para ponto flutuante de precisão simples, entre outras (RISC-V INTERNATIONAL, 2019).
Além disso, o RISC-V é uma arquitetura aberta e de uso livre, o que tem atraído o
interesse de diversas empresas para migrarem do ARM, arquitetura dominante até o período 
da realização deste projeto.

Atualmente diversas empresas têm projetos com RISC-V. Uma dessas empresas é a
desenvolvedora do MIPS, que possui o mesmo nome, e atualmente desenvolve
projetos com base no RISC-V. A empresa possui a linha eVocore, focada em tarefas
de computação intensiva, como: machine learning em dispositivos, 5G, data
centers e armazenamento, entre outras (“RISC-V ISA – MIPS”, [s.d.]) .

Outra empresa que utiliza o RISC-V é o Milk-V, uma empresa que desenvolve
produtos feitos com essa arquitetura. Um dos seus produtos é o Milk-V Duo, que
combina um processador ARM com um RISC-V, sendo possível escolher qual será
executado no momento de boot. Outra característica é que nele é possível rodar
dois sistemas operacionais concorrentes, um em cada núcleo de processamento do
dispositivo(Milk-V, [s.d.]).

Na categoria de microcontroladores, a Espressif, empresa que desenvolve a ESP32,
que originalmente utiliza chips com arquitetura Xtensa (ESPRESSIF, [s.d.]),
desenvolveu algumas versões com RISC-V. Na ESP32-S3, é utilizado um
coprocessador de baixo consumo utilizando o RV32IMC (ESPRESSIF., [s.d.]).
Enquanto na ESP32-C6 utiliza-se um processador implementado com o RV32IMAC
(ESPRESSIF, [s.d.]).

<!-- [^2022RISCVInternational]: RISC-V INTERNATIONAL. **The RISC-V Instruction Set Manual, Volume I: User-Level ISA, Document Version 20191213**. Editors Andrew Waterman and Krste Asanovic, 2019. Disponível em: https://riscv.org/technical/specifications/. Acesso em: 27 fev. 2024.  -->
