## 2. Metodologia

Para a estruturação do processador, optou-se por uma metodologia de
desenvolvimento hierárquico modularizado. A hierarquia do desenvolvimento se 
refere à separação do processador em diferentes níveis de integração, e 
a modularização à divisão dos elementos que compõem o processador em arquivos separados, 
ambos métodos que foram usados em conjunto para deixar o projeto mais organizado e 
facilitar futuras iterações do projeto, como implementação de tolerância a falhas 
por meio de tripla votação - redundância de componentes para o caso de um falhar, onde 
os outros são usados para definir o valor correto a ser considerado - , por exemplo.

Os níveis de integração do projeto foram:

- O nível mais baixo corresponde ao nível dos componentes, sejam eles genéricos
  (como multiplexadores) ou específicos da arquitetura RV32I (como a unidade de
  controle), como está ilustrado na Figura 2;

![](/images/reference/components/nivel_componentes.drawio.svg "**Figura 2** - Diagrama dos componentes implementados")

- Em seguida, o nível dos módulos, ilustrado na Figura 3. Vale mencionar que o Módulo Unidade de Controle é o único que 
implementa a lógica diretamente, sem fazer uso de componentes, já que esse módulo atua como ponte entre duas etapas do _pipeline_, mas ainda faz parte de uma etapa; 

![](/images/reference/components/nivel_modulos.drawio.svg "**Figura 3** - Diagrama dos módulos implementados")

- Há, então, o nível da CPU, onde estão os elementos que, integrados, compõem o processador, sendo esses 
as etapas do _pipeline_ e os elementos responsáveis por resolver os hazards, como 
se vê na Figura 4. Vale notar que os registradores das etapas são simbólicos, pois não existe um componente registrador específico para uso no _pipeline_. Ao invés disso, as próprias etapas do mesmo tem função de registrador.

![](/images/reference/components/nivel_etapas.drawio.svg "**Figura 4** - Diagrama das etapas implementados")

- Também faz parte do nível da CPU a implementação do _top level_ do processador, que é a integração dos elementos que compõem o mesmo, ou seja, a integração dos outros elementos que estão no nível da CPU como está ilustrado na Figura 5. 
Se faz necessário mencionar, que devido ao fato de 
o cliente querer usar memórias externas ao processador, o projeto foi realizado de forma que as memórias desenvolvidas pelo 
grupo para propósito de teste estão fora da CPU, e por isso estão representadas apenas para propósito de facilitar o 
entendimento da mesma, caso a situação não fosse essa, o grupo teria implementado as memórias nas etapas ID e MEM, o que é mais fácil de visualizar na Figura 1 (ver Seção 1.1).

![](/images/reference/components/nivel_superior.drawio.svg "**Figura 5** - Diagrama de Visão Geral da CPU")

- Por fim, tem-se o nível de visão geral do projeto, com a implementação da CPU e das memórias usadas para teste.

::: danger TO DO

Figura 6

:::

Já no que se refere à modularização, a mesma foi realizada seguindo a padronização explicitada no Apêndice A.

::: danger TO DO

Atualizar para apêndice(s) correto(s)

:::

### 2.1 Coleta de dados sobre o projeto

Os dados utilizados para realização deste projeto vieram de material, físico e digital, levantado pelos integrantes do projeto 
enquanto pesquisavam sobre o assunto, de conteúdo ensinado no curso de Engenharia de Computação, em específico na matéria de 
Design de Computadores lecionada por Paulo Carlos Ferreira dos Santos, de material que o orientador forneceu para ajudar na 
realização do projeto, de informações fornecidas pelo cliente, e de material que Rodrigo de Marca França forneceu.

No que se refere ao material levantado pelos integrantes, foi essencial o uso da documentação 
sobre a arquitetura de conjunto de instruções RISC-V (RISC-V INTERNATIONAL, 2019) fornecido pela RISC-V International, que é 
uma entidade sem fins lucrativos sediada na suíça, à qual o Brasil se juntou no final de fevereiro de 2024 (ver Seção 1.5) e 
que busca manter a neutralidade do desenvolvimento dessa arquitetura. Além disso, também foi encontrado um 
simulador _web_ (MARIOTTI; GIORGI, 2022) de um processador RISC-V com conjunto base de instruções para inteiros com extensão 
para multiplicação que funciona para uma arquitetura de 32 _bits_, que é precisamente o foco para este projeto, e auxiliou 
para que o fosse possível visualizar como que a arquitetura seria implementada, e como o processador interage com diferentes
instruções.

Já o conteúdo lecionado na matéria Design de Computadores, se refere ao desenvolvimento de um processador 
de arquitetura MIPS em VHDL usando o Quartus, que serviu como base de conhecimento para o desenvolvimento do projeto, já que 
foi experiência prática de desenvolvimento de um processador em VHDL, foco deste projeto, com uso da ferramenta Quartus, que 
foi necessária para validação deste projeto. Vale complementar que além 
do conhecimento adquirido nessa matéria, o curso de Engenharia da Computação também proporcionou conhecimento prático 
do uso de ferramentas como Docker, GitHub, GitHub Actions, Python e VSCode, o que resultou no estruturamento da metodologia 
de desenvolvimento técnico deste projeto.

Por sua vez, se tratando do material fornecido pelo orientador, o mais importante foi um repositório com componentes 
desenvolvidos em VHDL, onde os mesmos eram sintetizados usando GHDL, seus testes eram realizados usando Cocotb e Pytest, sendo 
que essas foram as ferramentas utilizadas no projeto para realizar os testes unitários e de integração de sistemas durante o 
projeto. Além disso, ele também forneceu livros que ajudaram no estudo da arquitetura e das suas instruções.

Já no que se refere às informações fornecidas pelos clientes, está a necessidade de modularização mencionada anteriormente na 
metodologia, assim como _feedback_ sobre as decisões tomadas ao longo do processo de desenvolvimento.

Por fim, o material fornecido por Rodrigo de Marca França foi o material de referência da agência espacial europeia, a ESA 
(European Space Agency).

## 2.2 Análise dos Dados Coletados

Na documentação sobre a arquitetura fornecida pelos materiais utilizados estão detalhadas as instruções que compõem o 
conjunto base de instruções para inteiros de 32 _bits_, sua estrutura e como elas funcionam, e o mesmo se aplica às 
instruções que compõem a extensão de multiplicação do processador (olhar Anexo A para mais informações sobre os conjuntos de 
instruções).

As instruções do conjunto base de inteiros são 40 no total, porém 3 destas instruções não foram implementadas (ECALL, 
EBREAK e FENCE) por elas serem de uso de processadores superescalares, que não faz parte do escopo. O conjunto de instruções 
da extensão de multiplicação serão implementadas se for factível a depender do tempo que sobrar após o término do 
desenvolvimento do processador funcional com as instruções do conjunto base implementadas, como acordado com o cliente.

Baseado nos conhecimentos adquiridos no curso de Engenharia de Computação, decidiu-se usar o GitHub Actions para automatizar o processo de testes CI/CD solicitados pelo cliente, e o Docker para padronizar o sistema operacional de desenvolvimento. Com 
o feedback positivo do cliente, essa metodologia de desenvolvimento se tornou parte essencial da entrega do projeto.